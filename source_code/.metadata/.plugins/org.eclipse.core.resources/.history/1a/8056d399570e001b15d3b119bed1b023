/*
 * main.c
 *
 *  Created on: 12 Oct 2020
 *      Author: pc
 */
#include "uart.h"
#include "external_eeprom.h"
//#define READY 255
#define r 100
enum READY{
	READY1=10,
	READY2=20,
	READY3=30
};
int main(){
	//uint8 sent_pass[7];
	uint8 x[7],i;
	/* Init EEPROM */
	EEPROM_init();
	UART_init();
	while(UART_recieveByte()!=READY){};
	for(i=0;i<5;i++){
		UART_sendByte(READY);
		x[i]=UART_recieveByte();
		EEPROM_writeByte((0x0000|i), x[i]);
		_delay_ms(100);
	}

	while(1){
		while(UART_recieveByte()!=r){};
		for(i=0;i<5;i++){
			UART_sendByte(r);
			EEPROM_readByte((0x0000|i), &x[i]);
			UART_sendByte(x[i]);
			_delay_ms(100);
		}
		while(UART_recieveByte()!=READY){};
		for(i=0;i<5;i++){
			UART_sendByte(READY);
			x[i]=UART_recieveByte();
			EEPROM_writeByte((0x0000|i), x[i]);
			_delay_ms(100);
		}
		while(UART_recieveByte()!=READY){};
		for(i=0;i<5;i++){
			UART_sendByte(READY);
			x[i]=UART_recieveByte();
			EEPROM_writeByte((0x0000|i), x[i]);
			_delay_ms(100);
		}


	}

	return 0;
}
