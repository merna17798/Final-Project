/*
 * main.c
 *
 *  Created on: 12 Oct 2020
 *      Author: pc
 */
#include "uart.h"
#include "external_eeprom.h"
#include <avr/io.h>

enum READY{
	READY1=10,
	READY2=20,
	READY3=30,
	READY4=40
};
static void Recive_Write_Memory(enum READY R){
	uint8 x[7],i,RECIEVE;
	RECIEVE=UART_recieveByte();
	while(RECIEVE!=R){};
	for(i=0;i<5;i++){
		UART_sendByte(R);
		x[i]=UART_recieveByte();
		EEPROM_writeByte((0x0000|i), x[i]);
		_delay_ms(100);
	}
}
static void Read_Send_Meomory(enum READY R){
	uint8 x[7],i,RECIEVE;
	RECIEVE=UART_recieveByte();
	while(RECIEVE!=R){};
	for(i=0;i<5;i++){
		UART_sendByte(R);
		EEPROM_readByte((0x0000|i), &x[i]);
		UART_sendByte(x[i]);
		_delay_ms(100);

	}
}
int main(){

	/* Init EEPROM */
	EEPROM_init();
	UART_init();
	/*
	uint8 RECIEVE;
	RECIEVE=UART_recieveByte();

	while(RECIEVE!=READY4){
		continue;
	}
	if(RECIEVE==READY4){
		DDRA|=(1<<0);
		CLEAR_BIT(PORTA,0);
		SET_BIT(PORTA,0);
		_delay_ms(10000);
	}
	*/

	//Recive_Write_Memory(READY1);
	Recive_Write_Memory(READY1);

	while(1){
		/*
		if(UART_recieveByte()==READY4){
			DDRA|=(1<<0);
			CLEAR_BIT(PORTA,0);
			SET_BIT(PORTA,0);
			_delay_ms(10000);
		}
		*/
		Read_Send_Meomory(READY2);
		/*
		if(UART_recieveByte()==READY4){
			DDRA|=(1<<0);
			CLEAR_BIT(PORTA,0);
			SET_BIT(PORTA,0);
			_delay_ms(1000);
			CLEAR_BIT(PORTA,0);
		}
		*/
		Recive_Write_Memory(READY3);
		/*
		if(UART_recieveByte()==READY4){
			DDRA|=(1<<0);
			CLEAR_BIT(PORTA,0);
			SET_BIT(PORTA,0);
			_delay_ms(10000);
		}
		*/
		Recive_Write_Memory(READY1);
	}

	return 0;
}
